{% extends "base.html" %}

{% load static %}
{% block content %}
<div class="flex h-full">
    <div class="p-4 min-w-64 hidden md:flex flex-col gap-7">
        <a href="/" class="flex items-center gap-2">
            <div class="btn">
                <img src="{% static 'img/arrow-left.svg' %}" alt="go back to home page button" width="18px" height="18px">
            </div>
            <p class="text-2xl">Settings</p>
        </a>
        <div class="flex flex-col items-start gap-2">
            <label class="hover:bg-base-200 w-full p-2 px-4 rounded-box cursor-pointer" for="organisation-profile">Organisation Profile</label>
            <label class=" hover:bg-base-200 w-full p-2 px-4 rounded-box cursor-pointer" for="user-management">Users Management</label>
            <label class=" hover:bg-base-200 w-full p-2 px-4 rounded-box cursor-pointer" for="issue-configurations">Issue Configurations</label>
            <label class=" hover:bg-base-200 w-full p-2 px-4 rounded-box cursor-pointer" for="notification-alerts">Notification & alerts</label>
            <label class=" hover:bg-base-200 w-full p-2 px-4 rounded-box cursor-pointer" for="security-settings">Security Settings</label>
        </div>
    </div>
    <div class="grow m-4 md:ml-0 flex flex-col gap-4 ">
        <form hx-post="" hx-swap="innerHTML" hx-target=""  class="flex gap-3 items-center justify-center">
            {% csrf_token %}
            <label class="input w-96">
                <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                <input name="search" type="search" required placeholder="Search"/>
            </label>
            <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
        </form>        

        <div class="card grow bg-base-200 drop-shadow-md">
            <a href="/" class="flex items-center justify-between p-3 md:hidden">
                <div class="flex items-center gap-2">
                    <div class="btn border border-neutral">
                        <img src="{% static 'img/arrow-left.svg' %}" alt="go back to home page button" width="18px" height="18px">
                    </div>
                    <p class="text-2xl">Settings</p>
                </div>
            </a>
            
            <div class="p-4 px-4 md:px-6">
    
                <div class="">
                    <!--organistaion profile-->
                    <input type="radio" checked name="menu"  class="hidden peer" id="organisation-profile">
                    <div class="peer-checked:flex flex-col hidden gap-4">
                        <p class="text-xl">Organisation Profile</p>
                        
                        {% if request.user.is_admin %}
                            <form action="/change_profile/" enctype="multipart/form-data" method="post" class="flex flex-col gap-1 px-2">
                                {% csrf_token %}
                                <div class="grid justify-center">
                                    {% include "component/image_btn.html" with previewImage=icon imagePreviewId="org_img_preview" imageInputId="org_img_input" %}
                                </div>
                                <label class="space-y-2">
                                    <p>Organisation Name</p>
                                    <input class="input w-full" placeholder="write name here..." type="text" name="title" value="{{config.name}}">
                                </label>
                                <label class="space-y-2">
                                    <p>Organisation Goal</p>
                                    <input class="input w-full" placeholder="write goal here..." type="text" name="desc" value="{{config.goal}}">
                                </label>
                                <button class="btn bg-success border border-accent p-2 w-fit px-6 self-end mt-2" type="submit">Change Details</button>
                            </form>
                        {% endif %}
                        
                        <div class="">
                            <p>Plans</p>
                            <p class="text-sm text-neutral">Organisation Plans</p>
                        </div>
                        <div class="p-2">
                            <div class="rounded-box border border-neutral">
                                <form class="p-4 flex gap-3 items-center" 
                                    hx-post="/search_plans/" 
                                    hx-swap="innerHTML" 
                                    hx-target="#plans-table"
                                >
                                    {% csrf_token %}
                                    <label class="input grow ">
                                        <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                                        <input name="search" id="search-plans-table" type="search" placeholder="Search"/>
                                    </label>
                                    <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
                                </form>
                                <div class="flex items-center justify-between border-t border-neutral p-2 ">
                                    <button class="btn bg-base-200 border-neutral border" 
                                        type="button"
                                        hx-target="#top-layer" 
                                        hx-swap="innerHTML"
                                        hx-get="/create_plan/" 
                                    >
                                        <img src="{% static 'img/add.svg' %}" alt="add" height="18px" width="18px">
                                        <span>New Plan</span>
                                    </button>
                                    
                                    <form class="text-sm flex items-center gap-2 p-2" 
                                        hx-post="/sort_plan/" 
                                        hx-trigger="change" 
                                        hx-swap="innerHTML" 
                                        hx-target="#plans-table"
                                        hx-include="#search-plans-table"
                                    >
                                        {% csrf_token %}
                                        <p>Sort by</p>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByCreated" value="1" name="sort"/>
                                            <label for="SortByCreated" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Date Created
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByUpdate" value="2" name="sort"/>
                                            <label for="SortByUpdate" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Date Updated
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByName" value="3" name="sort"/>
                                            <label for="SortByName" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Name
                                            </label>
                                        </div>
                                    </form>
                                    
                                </div>
                                <div id="plans-table">
                                    {% include "component/plan_table.html" with plans=plans %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        

                <div class="">
                    <!--user management-->
                    <input type="radio" name="menu"  class="hidden peer" id="user-management">
                    <div class="peer-checked:flex flex-col gap-4 hidden">
                        <p class="text-xl">User Management</p>

                        {% if request.user.is_admin %}
                            <div class="flex justify-between items-center">
                                <div class="">
                                    <p>Add User</p>             
                                    <p class="text-neutral text-sm">Create a new user for organisation</p>
                                </div>
                                <label class="btn border border-neutral" aria-label="show user creation form" for="hide-user-form">
                                    <img src="{% static 'img/chevron-down.svg' %}" alt="toggle user creation" width="24px" height="24px">
                                </label>
                            </div>
                            <input type="checkbox" id="hide-user-form" class="hidden peer" checked>
                            <form class="grid grid-cols-2 w-full peer-checked:hidden" action="" autocomplete="off" method="post">
                                <div class="flex w-full items-center justify-center">
                                    {% include "component/image_btn.html" with size="h-16 w-16" extraStyle="p-8" imagePreviewId="user_img_preview" imageInputId="user_img_input" %}
                                </div>
                                <div class="flex flex-col gap-2">
                                    <div class="flex flex-col gap-1">
                                        <p>Name</p> 
                                        <label class="input grow w-full">
                                            &#8204;
                                            <input name="user-field-1" type="text" required placeholder="&#8204;User Name&#8204;"/>
                                        </label>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <p>Email</p> 
                                        <label class="input grow w-full">
                                            &#8204;
                                            <input name="user-field-2" type="email" required placeholder="&#8204;Email@examplecom&#8204;"/>
                                        </label>
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <p>Password</p> 
                                        <label class="input grow w-full">
                                            &#8204;
                                            <input name="user-field-3" type="password" required placeholder="&#8204;User's password&#8204;"/>
                                        </label>
                                    </div>
                                    <p>Role</p> 
                                    <div class="flex gap-2 items-center">
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="role-admin" value="1" name="role"/>
                                            <label for="role-admin" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Admin
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="role-dev" value="2" name="role"/>
                                            <label for="role-dev" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Developer
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="role-review" value="3" name="role"/>
                                            <label for="role-review" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Reviewer
                                            </label>
                                        </div>
                                    </div>
                                    <button type="submit"  class="mt-2 btn bg-success border border-success-content">Create User</button>
                                </div>
                            </form>
                        {% endif %}
                        
                        <div class="">
                            <p>Existing User</p>
                            <p class="text-sm text-neutral">Manage Users Access</p>
                        </div>
                        <div class="p-2">
                            <div class="border flex flex-col border-neutral rounded-box">
                                <div class="p-2">
                                    <form hx-post="" hx-swap="innerHTML" hx-target=""  class="flex gap-3 items-center justify-center">
                                        {% csrf_token %}
                                        <label class="input grow w-96">
                                            <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                                            <input name="search" type="search" required placeholder="Search"/>
                                        </label>
                                        <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
                                    </form>
                                </div>
                                <div class="flex items-center border-t border-neutral p-2">

                                    <form class="text-sm flex items-center gap-2 p-2" hx-post=""  hx-swap="innerHTML" hx-target="">
                                        <p>Sort by</p>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByCreated-user" value="1" name="sort"/>
                                            <label for="SortByCreated-user" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Date Created
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByUpdate-user" value="2" name="sort"/>
                                            <label for="SortByUpdate-user" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Date Updated
                                            </label>
                                        </div>
                                        <div class="">
                                            <input type="radio" class="peer hidden" id="SortByName-user" value="3" name="sort"/>
                                            <label for="SortByName-user" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                Name
                                            </label>
                                        </div>
                                    </form>
                                </div>
                                <div class="">
                                    {% for user in users%}
                                        <div class="border-t border-neutral flex justify-between items-center p-2 px-4">
                                            
                                            <label class="flex gap-4 items-center">
                                                <input type="checkbox" name="check-user-{{user.id}}" >
                                                <img src="{{user.image.url}}" class="w-6 h-6 rounded-full " alt="" srcset="">
                                                <div class="flex flex-col items-start gap-0">
                                                    <p>{{user}}</p>
                                                    <p class="test-xs text-neutral">{{ user.email | default:"example@email.com"}}</p>
                                                </div>    
                                            </label>
    
                                            <div class="flex gap-4 items-center">
                                                {% if user.is_admin %}
                                                    <p>Admin</p>
                                                {% elif user.is_developer %}
                                                    <p>Developer</p>
                                                {% elif user.is_reporter %}
                                                    <p>Reporter</p>
                                                {% endif %}

                                                <button class="cursor-pointer hover:bg-base-100 p-2 py-4 rounded-box shadow-none"  type="button" aria-label="plan options">
                                                    <img src="{% static 'img/menu-dot.svg' %}" alt="open menu" width="16px" height="16px">
                                                </button>
                                            </div>                                            
                                        
                                        </div>    
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
        
                <div class="">
                    <!--Issue configuration-->
                    <input type="radio" name="menu"  class="hidden peer" id="issue-configurations">
                    <div class="peer-checked:flex flex-col gap-4 hidden">
                        <p class="text-lg">Issue Configurations</p>

                        <div class="">
                            Issue
                        </div>
                        <div class="px-2">
                            <div class="border flex flex-col border-neutral rounded-box">
                                <div class="p-2">
                                    <form hx-post="" hx-swap="innerHTML" hx-target=""  class="flex gap-3 items-center justify-center">
                                        {% csrf_token %}
                                        <label class="input grow w-96">
                                            <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                                            <input name="search" type="search" required placeholder="Search"/>
                                        </label>
                                        <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
                                    </form>
                                </div>
                                <div class="flex items-center border-t border-neutral p-2 px-4">
                                    <form class="text-sm flex items-center justify-between w-full" hx-post=""  hx-swap="innerHTML" hx-target="">
                                        <div class="relative">
                                            <label class="btn border border-neutral bg-base-100 p-1 px-4" type="button" for="dialog-plan-issue">
                                                <img src="{% static 'img/chevron-down.svg' %}" alt="show plans" width="18px" height="18px">
                                                <p>Plans</p>
                                            </label>
                                            <input type="checkbox" checked class="peer hidden" id="dialog-plan-issue">
                                            <dialog open class="absolute max-w-96 border border-neutral translate-y-1.5 drop-shadow-sm flex flex-col gap-1 p-1 rounded-box peer-checked:hidden">
                                                {% for plan in plans %}
                                                <label class="p-2 pr-4 flex items-center gap-3 rounded-box hover:bg-base-200 cursor-pointer">        
                                                    <input checked type="checkbox" name="sort-plans-issue" value="{{i}}" >
                                                    <div class="">
                                                        <p class="w-full truncate">{{plan.name}}</p>
                                                        <p class="text-sm text-neutral">{{plan.desc}}</p>
                                                    </div>
                                                </label>    
                                                {% endfor %}
                                            </dialog>
                                        </div>
                                        
                                        <div class="flex items-center gap-2">
                                            <p>Sort by</p>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByCreated-issue" value="1" name="sort"/>
                                                <label for="SortByCreated-issue" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Date Created
                                                </label>
                                            </div>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByUpdate-issue" value="2" name="sort"/>
                                                <label for="SortByUpdate-issue" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Date Updated
                                                </label>
                                            </div>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByName-issue" value="3" name="sort"/>
                                                <label for="SortByName-issue" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Name
                                                </label>
                                            </div>
                                        </div>
                                    </form>
                                </div>

                                <div class="">
                                    {% for issue in issues%}
                                        <div class="border-t border-neutral flex justify-between text-center p-2 px-4">
                                            
                                            {{issue}}
                                            
                                        </div>    
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="flex justify-between items-center">
                            <p>Isssue - Priorities</p>
                            <label class="btn border border-neutral" aria-label="toggle priorities table" for="toggle-priority">
                                <img src="{% static 'img/chevron-down.svg' %}" alt="show-plans" width="24px" height="24px">
                            </label>
                        </div>
                        <input checked type="checkbox" id="toggle-priority"  class="hidden peer">
                        <div class="px-2 peer-checked:hidden">
                            <div class="border flex flex-col border-neutral rounded-box">
                                <div class="p-2">
                                    <form hx-post="" hx-swap="innerHTML" hx-target=""  class="flex gap-3 items-center justify-center">
                                        {% csrf_token %}
                                        <label class="input grow w-96">
                                            <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                                            <input name="search" type="search" required placeholder="Search"/>
                                        </label>
                                        <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
                                    </form>
                                </div>
                                <div class="flex items-center border-t border-neutral p-2 px-4">
                                    <form class="text-sm flex items-center justify-between w-full" hx-post=""  hx-swap="innerHTML" hx-target="">

                                        <div class="relative">
                                            <label class="btn border border-neutral bg-base-100 p-1 px-4" type="button" for="dialog-plan-priority">
                                                <img src="{% static 'img/chevron-down.svg' %}" alt="show plans" width="18px" height="18px">
                                                <p>Plans</p>
                                            </label>
                                            <input type="checkbox" checked class="peer hidden" id="dialog-plan-priority">
                                            <dialog open class="absolute max-w-96 border border-neutral translate-y-1.5 drop-shadow-sm flex flex-col gap-1 p-1 rounded-box peer-checked:hidden">
                                                
                                                {% for plan in plans %}
                                                <label class="p-2 pr-4  flex items-center gap-3 rounded-box hover:bg-base-200 cursor-pointer">        
                                                    <input checked type="checkbox" name="sort-plans-priority" value="{{i}}">
                                                    <div class="">
                                                        <p class="w-full truncate">{{plan.name}}</p>
                                                        <p class="text-sm text-neutral">{{plan.desc}}</p>
                                                    </div>
                                                </label>    
                                                {% endfor %}

                                            </dialog>
                                        </div>

                                        <div class="flex items-center gap-2">
                                            <p>Sort by</p>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByCreated-priority" value="1" name="sort"/>
                                                <label for="SortByCreated-priority" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Date Created
                                                </label>
                                            </div>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByUpdate-priority" value="2" name="sort"/>
                                                <label for="SortByUpdate-priority" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Date Updated
                                                </label>
                                            </div>
                                            <div class="">
                                                <input type="radio" class="peer hidden" id="SortByName-priority" value="3" name="sort"/>
                                                <label for="SortByName-priority" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                    Name
                                                </label>
                                            </div>
                                        </div>
                                    </form>
                                    
                                </div>
                                <div class="">
                                    {% for priority in priorities%}
                                        <div class="border-t border-neutral flex justify-between text-center p-2 px-4">
                                            
                                            {{priority}}
                                            
                                        </div>    
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    
                        <div class="flex justify-between items-center">
                            <p>Isssue - Types</p>
                            <label class="btn border border-neutral" aria-label="toggle types table" for="toggle-types">
                                <img src="{% static 'img/chevron-down.svg' %}" alt="show plans" width="24px" height="24px">
                            </label>
                        </div>
                        <input type="checkbox" checked id="toggle-types" class="hidden peer">
                        <div class="px-2 peer-checked:hidden">
                            <div class="border flex flex-col border-neutral rounded-box">
                                <div class="p-2">
                                    <form hx-post="" hx-swap="innerHTML" hx-target=""  class="flex gap-3 items-center justify-center">
                                        {% csrf_token %}
                                        <label class="input grow w-96">
                                            <img src="{% static 'img/filter.svg' %}" height="24px" width="24px" alt="search bar" > 
                                            <input name="search" type="search" required placeholder="Search"/>
                                        </label>
                                        <button type="submit"  class="btn h-8 bg-success border border-success-content">Find</button>
                                    </form>
                                </div>
                                <div class="flex items-center border-t border-neutral p-2 px-4">
                                    
                                        <form class="text-sm flex items-center justify-between w-full" hx-post=""  hx-swap="innerHTML" hx-target="">
                                            
                                            <div class="relative">
                                                <label class="btn border border-neutral bg-base-100 p-1 px-4" type="button" for="dialog-plan-type">
                                                    <img src="{% static 'img/chevron-down.svg' %}" alt="show plans" width="18px" height="18px">
                                                    <p>Plans</p>
                                                </label>
                                                <input type="checkbox" checked class="peer hidden" id="dialog-plan-type">
                                                <dialog open class="absolute max-w-96 border border-neutral translate-y-1.5 drop-shadow-sm flex flex-col gap-1 p-1 rounded-box peer-checked:hidden">
                                                    {% for plan in plans %}
                                                    <label class="p-2 pr-4 flex items-center gap-3 rounded-box hover:bg-base-200 cursor-pointer">        
                                                        <input checked type="checkbox" name="sort-plans-type" value="{{i}}" >
                                                        <div class="">
                                                            <p class="w-full truncate">{{plan.name}}</p>
                                                            <p class="text-sm text-neutral">{{plan.desc}}</p>
                                                        </div>
                                                    </label>    
                                                    {% endfor %}
                                                </dialog>
                                            </div>

                                            <div class="flex items-center gap-2">
                                                <p>Sort by</p>
                                                <div class="">
                                                    <input type="radio" class="peer hidden" id="SortByCreated-type" value="1" name="sort"/>
                                                    <label for="SortByCreated-type" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                        Date Created
                                                    </label>
                                                </div>
                                                <div class="">
                                                    <input type="radio" class="peer hidden" id="SortByUpdate-type" value="2" name="sort"/>
                                                    <label for="SortByUpdate-type" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                        Date Updated
                                                    </label>
                                                </div>
                                                <div class="">
                                                    <input type="radio" class="peer hidden" id="SortByName-type" value="3" name="sort"/>
                                                    <label for="SortByName-type" class="peer-checked:text-black peer-checked:bg-white cursor-pointer rounded-box border border-neutral bg-base-200 p-2">
                                                        Name
                                                    </label>
                                                </div>
                                            </div>
                                        </form>
                                    
                                </div>
                                <div class="">
                                    {% for type in types%}
                                        <div class="border-t border-neutral flex justify-between text-center p-2 px-4">
                                            
                                            {{type}}
                                            
                                        </div>    
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        

                    </div>
                </div>
        
                <div class="">
                    <input type="radio" name="menu" class="hidden peer" id="notification-alerts">
                    <div class="peer-checked:flex flex-col gap-4 hidden">
                        <p class="text-lg">Notification & alerts</p>
                    </div>
                </div>
        
                <div class="">
                    <input type="radio" name="menu"  class="hidden peer" id="security-settings">
                    <div class="peer-checked:flex flex-col gap-4 hidden">
                        <p class="text-lg">Security Settings</p>
                    </div>
                </div>
            </div>
    
        </div>
    </div>
</div>
{% endblock content %}